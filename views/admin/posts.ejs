<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مدیریت پست‌ها</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css">
</head>

<body>
  <div class="admin-wrapper">
    <aside class="sidebar">
      <h2>مدیریت بلاگ</h2>
      <nav>
        <a href="/admin">🏠 داشبورد</a>
        <a href="/admin/posts" class="active">📝 پست‌ها</a>
        <a href="/admin/users">👥 کاربران</a>
        <a href="/admin/banned-users">🚫 کاربران بن‌شده</a>
        <a href="/">🔙 بازگشت به سایت</a>
      </nav>
    </aside>

    <main class="content">
      <header class="admin-header">
        <h1>مدیریت پست‌ها</h1>
        <form action="/user/logout" method="post">
          <button class="logout-btn">خروج</button>
        </form>
      </header>

      <section class="latest-posts">
        <h2>🆕 پست‌ها</h2>
        <table>
          <thead>
            <tr>
              <th>عنوان</th>
              <th>نویسنده</th>
              <th>تاریخ</th>
              <th>عملیات</th>
            </tr>
          </thead>
          <tbody>
            <%posts.forEach(post=>{%>
              <tr>
                <td>
                  <%=post.title%>
                </td>
                <td>
                  <%=post.user.username%>
                </td>
                <td>
                  <%=post.updatedAt%>
                </td>
                <td>
                  <a href="#" class="btn small view">مشاهده</a>
                  <form action="/admin/post/<%= post._id %>/delete" method="post"
                    onsubmit="return confirm('آیا از حذف این پست مطمئن هستید؟')" style="display:inline;">
                    <button type="submit" class="btn small delete">حذف</button>
                  </form>
                </td>
              </tr>
              <%})%>
          </tbody>
        </table>
      </section>
      <div class="pagination">
        <% if (pagination.page> 1) { %>
          <a href="?page=<%= +pagination.page - 1 %>" class="page-btn prev">قبلی</a>
          <% } else { %>
            <span class="page-btn prev disabled">قبلی</span>
            <% } %>

              <div class="page-numbers">
                <% for (let i=1; i <=pagination.totalPage; i++) { %>
                  <a href="?page=<%= i %>" class="page-number <%= i === pagination.page ? 'active' : '' %>">
                    <%= i %>
                  </a>
                  <% } %>
              </div>

              <% if (pagination.page < pagination.totalPage) { %>
                <a href="?page=<%= +pagination.page + 1 %>" class="page-btn next">بعدی</a>
                <% } else { %>
                  <span class="page-btn next disabled">بعدی</span>
                  <% } %>
      </div>
    </main>
  </div>
  <script src="/js/sweetalert.js"></script>
  <script>
    if ("<%=locals.messages.success%>") {
      swal({
        title: "Success",
        text: "<%=locals.messages.success%>",
        icon: "success",
        button: "ok",
      })
    } else if ("<%=locals.messages.error%>") {
      swal({
        title: "Error",
        text: "<%=locals.messages.error%>",
        icon: "error",
        button: "try again",
      })
    } 
  </script>
</body>

</html>