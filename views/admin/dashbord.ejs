<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>پنل ادمین</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css">
</head>

<body>
  <div class="admin-wrapper">
    <aside class="sidebar">
      <h2>مدیریت بلاگ</h2>
      <nav>
        <a href="/admin" class="active">🏠 داشبورد</a>
        <a href="/admin/posts">📝 پست‌ها</a>
        <a href="/admin/users">👥 کاربران</a>
        <a href="/">🔙 بازگشت به سایت</a>
      </nav>
    </aside>

    <main class="content">
      <header class="admin-header">
        <h1>داشبورد مدیریت</h1>
        <form action="/user/logout" method="post">
          <button class="logout-btn">خروج</button>
        </form>
      </header>

      <section class="stats">
        <div class="stat-card">
          <h3>👥 تعداد کاربران</h3>
          <p>
            <%=usersCount%>
          </p>
        </div>
        <div class="stat-card">
          <h3>📰 تعداد پست‌ها</h3>
          <p>
            <%=postsCount%>
          </p>
        </div>
      </section>

      <section class="latest-posts">
        <h2>🆕 آخرین پست‌ها</h2>
        <table>
          <thead>
            <tr>
              <th>عنوان</th>
              <th>نویسنده</th>
              <th>تاریخ</th>
              <th>عملیات</th>
            </tr>
          </thead>
          <tbody>
            <%lastPosts.forEach(post=>{%>
              <tr>
                <td>
                  <%=post.title%>
                </td>
                <td>
                  <%=post.user.username%>
                </td>
                <td>
                  <%=post.updatedAt%>
                </td>
                <td>
                  <a href="#" class="btn small view">مشاهده</a>
                  <form action="/admin/post/<%= post._id %>/delete" method="post"
                    onsubmit="return confirm('آیا از حذف این پست مطمئن هستید؟')" style="display:inline;">
                    <button type="submit" class="btn small delete">حذف</button>
                  </form>
                </td>
              </tr>
              <%})%>
          </tbody>
        </table>
      </section>

      <section class="latest-users">
        <h2>👤 آخرین کاربران ثبت‌نام‌شده</h2>
        <table>
          <thead>
            <tr>
              <th>پروفایل</th>
              <th>نام کاربری</th>
              <th>ایمیل</th>
              <th>نقش</th>
              <th>عملیات</th>
            </tr>
          </thead>
          <tbody>
            <%lastUsers.forEach(user=>{%>
              <tr>
                <td><img src="<%=user.profile%>" alt="profile" class="avatar"></td>
                <td>
                  <%=user.username%>
                </td>
                <td>
                  <%=user.email%>
                </td>
                <td>
                  <%=user.role%>
                </td>
                <td>
                  <form action="/admin/users/<%= user._id %>/ban" method="post"
                    onsubmit="return confirm('آیا از مسدود کردن این کاربر مطمئن هستید؟')" style="display:inline;">
                    <button type="submit" class="btn small danger">مسدود</button>
                  </form>
                  <form action="/admin/users/<%= user._id %>/change-role" method="post"
                    onsubmit="return confirm('آیا از تغییر پست این کاربر مطمئن هستید؟')" style="display:inline;">
                    <button type="submit" class="btn small">تغییر نقش</button>
                  </form>
                </td>
              </tr>
              <%})%>
          </tbody>
        </table>
      </section>
    </main>
  </div>
  <script src="/js/sweetalert.js"></script>
  <script>
    if ("<%=locals.messages.success%>") {
      swal({
        title: "Success",
        text: "<%=locals.messages.success%>",
        icon: "success",
        button: "ok",
      })
    } else if ("<%=locals.messages.error%>") {
      swal({
        title: "Error",
        text: "<%=locals.messages.error%>",
        icon: "error",
        button: "try again",
      })
    } 
  </script>
</body>

</html>